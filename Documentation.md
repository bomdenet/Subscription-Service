# sub_serv
Наш проект разделён на 2 части: серверную и клиентскую.

## SubServServer
Чтобы запустить сервер, необходимо выполнить команду:
```python
import asyncio
from sub_serv_server import *

# Данный сервер будет работать только на данном пк
asyncio.run(start_server("127.0.0.1", 8888))
```

## SubServClient
Для подключению к серверу необходимо указать его ip и port:
```python
from sub_serv_client import SubServClient


client = SubServClient("127.0.0.1", 8888)
```

```SubServClient``` отвечает за подключение к серверу, а так же авторизацию пользователя. Данный класс имеет 5 основных функций:
```python
# Функция, которая проверяет существует ли пользователь с данным ником
client.user_exists(username)
# Возвращает True/False

# Функция, которая проверяет ник на валидность
client.check_correct_username(username)
# Возвращает True или текст с ошибкой

# Функция, которая проверяет пароль на валидность
client.check_correct_password(password)
# Возвращает True или текст с ошибкой

# Функция, для регистрации пользователя
user = client.reg(username, password)
# Возвращает SubServClient нового пользователя или строку с ошибкой

# Функция, для авторизации пользователя
user = client.auth(username, password)
# Возвращает SubServClient или строку с ошибкой
```
Данные функции так же могут вернуть ```None```, при условии, что были проблемы при отправке сообщения

## SubServUser
### Функции для всех пользователей

```SubServUser``` класс для взаимодействия пользователю. Он хранит в себе функции, которые непосредственно влияют на самого пользователя.  
Чтобы получить базовую информаци о пользователе, нужно вызвать даннуб функцию
```python
info = user.get_user_info()
# Возвращает словарь типа:
# {
#     'username': 'username',
#     'is_admin': 0,
#     'subscription': 0,
#     'subscription_name': None,
#     'balance': 0
# }
```
```is_admin``` может принимать значения 0 или 1.  
```subscription``` это дата, до которой действует подписка(в Unix формате). Для перевода рекомендуется использовать следующую функцию:
```python
from datetime import datetime, timezone


def int_to_local_date(timesnap: int):
    if timesnap <= 0:
        return datetime(1970, 1, 1, tzinfo=timezone.utc)
    return datetime.fromtimestamp(timesnap).astimezone()
```
```subscription_name``` название действующей подписки.  

Для получения истории платежей, необходимо вызвать функцию:
```python
payments = user.get_user_payments_history()
# Возвращает массив словарей типа:
# {
#     'id': 1,
#     'amount': 1000,
#     'date': 1748816503,
# }
```
```amount``` - сумма платежа.  
```date``` - дата платежа в Unix формате.  

Для создания платежа, необходимо использовать данную функцию:
```python
user.add_payment(5000)
```
Данная функция создаст платёж на 5000 рублей. Деньги так же прибаятся к балансу.  

Для получения информации о типах подписок, необходимо вызвать функцию:
```python
subscriptions = user.get_available_subscriptions()
# Возвращает массив словарей типа:
# {
#     'name_subscr': 'name',
#     'price': 299,
#     'length': 30,
# }
```
```name_subscr``` - название подписки.  
```price``` - цена подписки.  
```length``` - продолжительность подписки(в днях).  

Для попытки оплатить подписку, необходимо воспользоваться функцией:
```python
user.assign_subscription_to_user("Standart")
```
Возвращает ```True``` при успешности, либо строку с ошибкой.  

### Функции для админов
Чтобы добавить новую подписку, необходимо воспользоваться функцией:
```python
user.add_subscribe("name subscribe", length, price)
```
Возвращает ```True``` при успешности, либо строку с ошибкой.  

Чтобы изменить существующую подписку, необходимо воспользоваться функцией:
```python
user.edit_subscribe("name subscribe", length, price)
```
Возвращает ```True``` при успешности, либо строку с ошибкой.  

Чтобы удалить подписку, необходимо воспользоваться функцией:
```python
user.delete_subscribe("name subscribe")
```
Возвращает ```True``` при успешности, либо строку с ошибкой.  

Если админу необходимо выдать другому пользователю подписку, то необходимо воспользоваться функцией:
```python
user.admin_assign_custom_subscription(username, length)
```
```username``` это ник пользователя, которому надо выдать подписка на ```length``` дней.  
Возвращает ```True``` при успешности, либо строку с ошибкой. 

Если админу необходимо выдать или забрать у другого пользователя админку, то необходимо воспользоваться функцией:
```python
user.set_admin_status(username, status)
```
```username``` это ник пользователя, которому необходимо выдать или забрать админку.  
```status``` - значение int 0 (обычный пользователь) или 1 (админ).  
Возвращает ```True``` при успешности, либо строку с ошибкой. 